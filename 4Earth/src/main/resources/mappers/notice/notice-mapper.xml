<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.kh.earth.notice.model.dao.NoticeMapper">
	<sql id="noticeListSql">
		SELECT  N.NOTICE_NO, 
		        M.ID, 
		        N.NOTICE_TIT, 
		        N.NOTICE_CONTENT, 
		        N.NOTICE_COUNT, 
		        N.ORIGINAL_FILENAME, 
		        N.RENAMED_FILENAME, 
		        N.DATE_WRITEN, 
		        N.DATE_WRITEN_MODIFY, 
		        N.NOTICE_STATUS 
		FROM NOTICE N 
		JOIN MEMBER M ON(N.WRITER_NO = M.NO) 
		WHERE N.NOTICE_STATUS = 'Y' 
	</sql>

	<resultMap type="Notice" id="noticeListResultMap">
		<id property="no" column="NOTICE_NO"/>
		<result property="writerNo" column="WRITER_NO"/>
		<result property="writerId" column="ID"/>
		<result property="title" column="NOTICE_TIT"/>
		<result property="content" column="NOTICE_CONTENT"/>
		<result property="readCount" column="NOTICE_COUNT"/>
		<result property="originalFileName" column="ORIGINAL_FILENAME"/>
		<result property="renamedFileName" column="RENAMED_FILENAME"/>
		<result property="createDate" column="DATE_WRITEN"/>
		<result property="modifyDate" column="DATE_WRITEN_MODIFY"/>
		<result property="status" column="NOTICE_STATUS"/>
	</resultMap>
	
	<select id="findAll" parameterType="map" resultMap="noticeListResultMap">
		<include refid="noticeListSql"/>
		<choose>
			<when test="writerId != null">
				AND M.ID LIKE '%' || #{writer} || '%'
			</when>
			<when test="title != null">
				AND N.NOTICE_TIT LIKE '%' || #{title} || '%'
			</when>
			<when test="content != null">
				AND N.NOTICE_CONTENT LIKE '%' || #{content} || '%'
			</when>
		</choose>
		ORDER BY N.NOTICE_NO DESC
	</select>
	
	<select id="getNoticeCount" parameterType="map" resultType="_int">
		SELECT COUNT(*) 
		FROM NOTICE
		WHERE NOTICE_STATUS = 'Y'
		<choose>
			<when test="writerId != null">
				AND M.ID LIKE '%' || #{writer} || '%'
			</when>
			<when test="title != null">
				AND N.NOTICE_TIT LIKE '%' || #{title} || '%'
			</when>
			<when test="content != null">
				AND N.NOTICE_CONTENT LIKE '%' || #{content} || '%'
			</when>
		</choose>
	</select>
	
	
	<insert id="insertNotice" parameterType="Notice"
			useGeneratedKeys="true" keyProperty="no" keyColumn="NOTICE_NO">
		INSERT INTO NOTICE (
				NOTICE_NO, 
				WRITER_NO,
			  NOTICE_TIT, 
			  NOTICE_CONTENT, 
			  NOTICE_COUNT, 
			  ORIGINAL_FILENAME, 
			  RENAMED_FILENAME, 
			  DATE_WRITEN, 
			  DATE_WRITEN_MODIFY, 
			  NOTICE_STATUS 
		) VALUES (
				SEQ_NOTICE_NO.NEXTVAL,
				#{writerNo},
				#{title},
				#{content},
				DEFAULT,
				#{originalFileName},
				#{renamedFileName},
				DEFAULT,
				DEFAULT,
				DEFAULT
		)
	</insert>

</mapper>